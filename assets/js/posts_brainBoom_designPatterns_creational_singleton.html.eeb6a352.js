"use strict";(self.webpackChunkmiaoxi_blog=self.webpackChunkmiaoxi_blog||[]).push([[8938],{66262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},5356:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>h,data:()=>p});var n=a(20641);const l=a.p+"assets/img/singleton-comic-1-zh.7a683cb7.png",e=a.p+"assets/img/singleton.4f7c6272.png",t={},h=(0,a(66262).A)(t,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,s[0]||(s[0]=[(0,n.Fv)('<h2 id="意图" tabindex="-1"><a class="header-anchor" href="#意图"><span>意图</span></a></h2><p>单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。</p><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题</span></a></h2><p>单例模式同时解决了两个问题， 所以违反了单一职责原则：</p><ol><li><strong>保证一个类只有一个实例</strong>。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。</li></ol><p>它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。</p><p>注意， 普通构造函数无法实现上述行为， 因为构造函数的设计决定了它必须总是返回一个新对象。</p><figure><img src="'+e+'" alt="客户端甚至可能没有意识到它们一直都在使用同一个对象" tabindex="0" loading="lazy"><figcaption>客户端甚至可能没有意识到它们一直都在使用同一个对象</figcaption></figure><ol start="2"><li><strong>为该实例提供一个全局访问节点</strong>。 还记得你 （好吧， 其实是我自己） 用过的那些存储重要对象的全局变量吗？ 它们在使用上十分方便， 但同时也非常不安全， 因为任何代码都有可能覆盖掉那些变量的内容， 从而引发程序崩溃。<br> 和全局变量一样， 单例模式也允许在程序的任何地方访问特定对象。 但是它可以保护该实例不被其他代码覆盖。<br> 还有一点： 你不会希望解决同一个问题的代码分散在程序各处的。 因此更好的方式是将其放在同一个类中， 特别是当其他代码已经依赖这个类时更应该如此。</li></ol><p>如今， 单例模式已经变得非常流行， 以至于人们会将只解决上文描述中任意一个问题的东西称为单例。</p><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h2><p>所有单例的实现都包含以下两个相同的步骤：</p><ul><li>将默认构造函数设为私有， 防止其他对象使用单例类的 new 运算符。</li><li>新建一个静态构建方法作为构造函数。 该函数会 “偷偷” 调用私有构造函数来创建对象， 并将其保存在一个静态成员变量中。 此后所有对于该函数的调用都将返回这一缓存对象。</li></ul><p>如果你的代码能够访问单例类， 那它就能调用单例类的静态方法。 无论何时调用该方法， 它总是会返回相同的对象。</p><h2 id="真实世界类比" tabindex="-1"><a class="header-anchor" href="#真实世界类比"><span>真实世界类比</span></a></h2><p>政府是单例模式的一个很好的示例。 一个国家只有一个官方政府。 不管组成政府的每个人的身份是什么， ​ “某政府” 这一称谓总是鉴别那些掌权者的全局访问节点。</p><h2 id="单例模式结构" tabindex="-1"><a class="header-anchor" href="#单例模式结构"><span>单例模式结构</span></a></h2><figure><img src="data:image/png;base64,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" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol><li>单例 （Singleton） 类声明了一个名为 get­Instance 获取实例的静态方法来返回其所属类的一个相同实例。<br> 单例的构造函数必须对客户端 （Client） 代码隐藏。 调用 获取实例方法必须是获取单例对象的唯一方式。</li></ol><h2 id="伪代码" tabindex="-1"><a class="header-anchor" href="#伪代码"><span>伪代码</span></a></h2><p>在本例中， 数据库连接类即是一个单例。 该类不提供公有构造函数， 因此获取该对象的唯一方式是调用 获取实例方法。 该方法将缓存首次生成的对象， 并为所有后续调用返回该对象。</p><div class="language-py line-numbers-mode" data-highlighter="shiki" data-ext="py" data-title="py" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 数据库类会对`getInstance（获取实例）`方法进行定义以让客户端在程序各处</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 都能访问相同的数据库连接实例。</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Database </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 保存单例实例的成员变量必须被声明为静态类型。</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    private static field instance: Database</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 单例的构造函数必须永远是私有类型，以防止使用`new`运算符直接调用构</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 造方法。</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    private constructor </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 部分初始化代码（例如到数据库服务器的实际连接）。</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ……</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 用于控制对单例实例的访问权限的静态方法。</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    public static method </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">getInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Database.instance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> null) then</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            acquireThreadLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">and</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> then</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                # 确保在该线程等待解锁时，其他线程没有初始化该实例。</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Database.instance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> null) then</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    Database.instance </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Database.instance</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 最后，任何单例都必须定义一些可在其实例上执行的业务逻辑。</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    public method </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(sql) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 比如应用的所有数据库查询请求都需要通过该方法进行。因此，你可以</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 在这里添加限流或缓冲逻辑。</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ……</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Application </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    method </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">is</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        Database foo </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Database.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">getInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        foo.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SELECT ……&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ……</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        Database bar </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Database.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">getInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        bar.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SELECT ……&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 变量 `bar` 和 `foo` 中将包含同一个对象。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="单例模式优缺点" tabindex="-1"><a class="header-anchor" href="#单例模式优缺点"><span>单例模式优缺点</span></a></h2><p>√ 你可以保证一个类只有一个实例。<br> √ 你获得了一个指向该实例的全局访问节点。<br> √ 仅在首次请求单例对象时对其进行初始化。<br> × 违反了单一职责原则。 该模式同时解决了两个问题。<br> × 单例模式可能掩盖不良设计， 比如程序各组件之间相互了解过多等。<br> × 该模式在多线程环境下需要进行特殊处理， 避免多个线程多次创建单例对象。<br> × 单例的客户端代码单元测试可能会比较困难， 因为许多测试框架以基于继承的方式创建模拟对象。 由于单例类的构造函数是私有的， 而且绝大部分语言无法重写静态方法， 所以你需要想出仔细考虑模拟单例的方法。 要么干脆不编写测试代码， 或者不使用单例模式。</p><h2 id="与其他模式的关系" tabindex="-1"><a class="header-anchor" href="#与其他模式的关系"><span>与其他模式的关系</span></a></h2><ul><li><p>外观模式类通常可以转换为单例模式类， 因为在大部分情况下一个外观对象就足够了。</p></li><li><p>如果你能将对象的所有共享状态简化为一个享元对象， 那么享元模式就和单例类似了。 但这两个模式有两个根本性的不同。</p><ol><li>只会有一个单例实体， 但是享元类可以有多个实体， 各实体的内在状态也可以不同。</li><li>单例对象可以是可变的。 享元对象是不可变的。</li></ol></li><li><p>抽象工厂模式、 生成器模式和原型模式都可以用单例来实现。</p></li></ul>',27)]))}]]),p=JSON.parse('{"path":"/posts/brainBoom/designPatterns/creational/singleton.html","title":"单例模式","lang":"zh-CN","frontmatter":{"title":"单例模式","icon":"/assets/images/brainBoom/designPatterns/creational/singleton/singleton-mini.png","order":5,"category":["设计模式"],"description":"意图 单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。 问题 单例模式同时解决了两个问题， 所以违反了单一职责原则： 保证一个类只有一个实例。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。 它的运作方式是这样的： 如果你创建了一个对象，...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/posts/brainBoom/designPatterns/creational/singleton.html"}],["meta",{"property":"og:site_name","content":"大喵喜的技术杂货铺"}],["meta",{"property":"og:title","content":"单例模式"}],["meta",{"property":"og:description","content":"意图 单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。 问题 单例模式同时解决了两个问题， 所以违反了单一职责原则： 保证一个类只有一个实例。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。 它的运作方式是这样的： 如果你创建了一个对象，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-25T09:55:34.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-25T09:55:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"单例模式\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-25T09:55:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Jianshu.Shi\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"意图","slug":"意图","link":"#意图","children":[]},{"level":2,"title":"问题","slug":"问题","link":"#问题","children":[]},{"level":2,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]},{"level":2,"title":"真实世界类比","slug":"真实世界类比","link":"#真实世界类比","children":[]},{"level":2,"title":"单例模式结构","slug":"单例模式结构","link":"#单例模式结构","children":[]},{"level":2,"title":"伪代码","slug":"伪代码","link":"#伪代码","children":[]},{"level":2,"title":"单例模式优缺点","slug":"单例模式优缺点","link":"#单例模式优缺点","children":[]},{"level":2,"title":"与其他模式的关系","slug":"与其他模式的关系","link":"#与其他模式的关系","children":[]}],"git":{"createdTime":1741180358000,"updatedTime":1742896534000,"contributors":[{"name":"damiaoxi","username":"damiaoxi","email":"miaoxi1110@gmail.com","commits":1,"url":"https://github.com/damiaoxi"},{"name":"Jianshu","username":"Jianshu","email":"jianshu.shi@eisgroup.com","commits":3,"url":"https://github.com/Jianshu"}]},"readingTime":{"minutes":5.48,"words":1645},"localizedDate":"2025年3月5日","excerpt":"<h2>意图</h2>\\n<p>单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。</p>\\n<figure><figcaption></figcaption></figure>\\n<h2>问题</h2>\\n<p>单例模式同时解决了两个问题， 所以违反了单一职责原则：</p>\\n<ol>\\n<li><strong>保证一个类只有一个实例</strong>。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。</li>\\n</ol>\\n<p>它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。</p>","autoDesc":true}')}}]);